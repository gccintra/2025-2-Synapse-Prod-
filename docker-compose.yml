version: '3.8'

services:
  backend:
    build: ./backend
    restart: always
    environment:
      # O Railway injeta a PORT automaticamente, não precisa definir porta fixa
      # Mapeando variáveis do Railway para o Container:
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET_KEY: ${JWT_SECRET_KEY}
      GNEWS_API_KEY: ${GNEWS_API_KEY}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GMAIL_SENDER_EMAIL: ${GMAIL_SENDER_EMAIL}
      GMAIL_APP_PASSWORD: ${GMAIL_APP_PASSWORD}

  frontend:
    build: ./frontend
    restart: always
    environment:
      # Se for Vite/React (SPA), essas variaveis precisam ser em tempo de BUILD (ARG)
      # Se for Next.js (SSR), funciona aqui. 
      # Ajuste conforme seu framework, mas geralmente é necessário saber a URL do back:
      VITE_API_URL: ${VITE_API_URL} # ou NEXT_PUBLIC_API_URL
      
  cron:
    build:
      context: ./backend
      dockerfile: dockerfile.cron
    restart: always
    environment:
      DATABASE_URL: ${DATABASE_URL}
      GNEWS_API_KEY: ${GNEWS_API_KEY}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GMAIL_SENDER_EMAIL: ${GMAIL_SENDER_EMAIL}
      GMAIL_APP_PASSWORD: ${GMAIL_APP_PASSWORD}